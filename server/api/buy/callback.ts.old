import Stripe from 'stripe';


const stripe = new Stripe(process.env.STRIPE_SECRET_KEY as string);

export default defineEventHandler(async (event) => {
    const eventS = stripe.webhooks.constructEvent(
        await readRawBody(event) as string,
        getHeader(event, 'stripe-signature') as string,
        "whsec_f428fa267f000eb5016802d9b52f9c35e9fb42952831a68cb5c38a08be0eee2b");

    if (eventS.type === "payment_intent.succeeded") {
        const paymentIntent = eventS.data.object as Stripe.PaymentIntent;
        // console.log('PaymentIntent was successful!', paymentIntent);

        // Accessing metadata
        const metadata = paymentIntent.metadata;
        console.log('recive: ', metadata);
    }

    return {
        statusCode: 200,
        body: 'Success'
    };
})